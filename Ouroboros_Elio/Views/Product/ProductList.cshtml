@model List<BusinessLogicLayer.Dtos.DesignDtos.DesignViewModel>

<body class="template-color-1">
    <div class="main-wrapper">
        <!-- Begin Hiraola's Breadcrumb Area -->
        <div class="breadcrumb-area">
            <div class="container">
                <div class="breadcrumb-content">
                    <h2>Cửa Hàng</h2>
                    <ul>
                        <li><a href="index.html">Trang Chủ</a></li>
                        <li class="active">Sản Phẩm</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Hiraola's Breadcrumb Area End Here -->
        <!-- Begin Hiraola's Content Wrapper Area -->
        <div class="hiraola-content_wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 order-2 order-lg-1">
                        <div class="hiraola-sidebar-catagories_area">
                            <div class="hiraola-sidebar_categories">
                                <div class="hiraola-categories_title">
                                    <h5>Tìm Kiếm Theo Giá</h5>
                                </div>
                                <div class="price-filter">
                                    <div class="price-inputs">
                                        <label><strong>Giá tối thiểu</strong>: </label>
                                        <div class="input-wrapper">
                                            <input type="number" id="minPrice" name="minPrice" placeholder="Giá tối thiểu" min="0" value="@ViewBag.MinPrice" />
                                            <span class="error-message" id="minPriceError"></span>
                                        </div>
                                        <label><strong>Giá tối đa</strong>: </label>
                                        <div class="input-wrapper">
                                            <input type="number" id="maxPrice" name="maxPrice" placeholder="Giá tối đa" min="0" value="@ViewBag.MaxPrice" />
                                            <span class="error-message" id="maxPriceError"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="category-module hiraola-sidebar_categories">
                                <div class="category-module_heading">
                                    <h5>Mẫu sản phẩm</h5>
                                </div>
                                <div class="module-body">
                                    <ul class="module-list_item">                                        
                                        <li>
                                            <a href="javascript:void(0)" class="model-filter @(ViewBag.ModelId == null ? "active" : "")" data-model-id="">Tất cả</a>
                                            @if (ViewBag.ListModel != null)
                                            {
                                                foreach (var models in ViewBag.ListModel)
                                                {
                                                    <a href="javascript:void(0)" class="model-filter @(ViewBag.ModelId == models.ModelId ? "active" : "")" data-model-id="@models.ModelId">@models.ModelName</a>
                                                }
                                            }
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9 order-1 order-lg-2">
                        <div class="shop-toolbar">
                            <div class="product-view-mode">
                                <a class="active grid-3"
                                   data-target="gridview-3"
                                   data-toggle="tooltip"
                                   data-placement="top"
                                   title="Grid View">
                                    <i class="fa fa-th"></i>
                                </a>
                                <a class="list"
                                   data-target="listview"
                                   data-toggle="tooltip"
                                   data-placement="top"
                                   title="List View">
                                    <i class="fa fa-th-list"></i>
                                </a>
                            </div>
                            <div class="product-item-selection_area">
                                <div class="product-short">
                                    <label class="select-label">Sắp Xếp:</label>
                                    <select class="nice-select">
                                        <option value="1">Tất cả</option>
                                        <option value="2">Mới Nhất</option>
                                        <option value="3">Bán Chạy</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="shop-product-wrap grid gridview-3 row">
                            @if (Model != null && Model.Any())
                            {
                                foreach (var item in Model)
                                {
                                    <div class="col-lg-4">
                                        <div class="slide-item">
                                            <div class="single_product">
                                                <div class="product-img">
                                                    <a asp-area="" asp-controller="Product" asp-action="ProductDetail" asp-route-designId="@item.DesignId">
                                                        <img class="primary-img"
                                                             src="@item.FirstImage.ImageUrl"
                                                             alt="Hiraola's Product Image" />
                                                        <img class="secondary-img"
                                                             src="@item.FirstImage.ImageUrl"
                                                             alt="Hiraola's Product Image" />
                                                    </a>
                                                    <div class="add-actions">
                                                        <ul>
                                                            <li>
                                                                <a class="hiraola-add_cart"
                                                                   href="javascript:void(0)"
                                                                   onclick="addToCart('@item.DesignId', 1, false)"
                                                                   data-bs-toggle="tooltip"
                                                                   data-placement="top"
                                                                   title="Thêm">
                                                                    <i class="ion-bag"></i>
                                                                </a>
                                                            </li>
                                                            <li class="quick-view-btn"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#exampleModalCenter">
                                                                <a asp-controller="Product"
                                                                   asp-action="ProductDetail"
                                                                   asp-route-designId="@item.DesignId"
                                                                   data-bs-toggle="tooltip"
                                                                   data-placement="top"
                                                                   title="Xem">
                                                                    <i class="ion-eye"></i>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="hiraola-product_content">
                                                    <div class="product-desc_info">
                                                        <h6>
                                                            <a class="product-name" asp-area="" asp-controller="Product" asp-action="ProductDetail"
                                                               asp-route-designId="@item.DesignId">@item.DesignName</a>
                                                        </h6>
                                                        <div class="price-box">
                                                            <span class="new-price">@item.Price VND</span>
                                                        </div>
                                                        <div class="rating-box">
                                                            <ul>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li class="silver-color">
                                                                    <i class="fa fa-star-of-david"></i>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="list-slide_item">
                                            <div class="single_product">
                                                <div class="product-img">
                                                    <a href="single-product.html">
                                                        <img class="primary-img"
                                                             src="@item.FirstImage.ImageUrl"
                                                             alt="Hiraola's Product Image" />
                                                        <img class="secondary-img"
                                                             src="@item.FirstImage.ImageUrl"
                                                             alt="Hiraola's Product Image" />
                                                    </a>
                                                </div>
                                                <div class="hiraola-product_content">
                                                    <div class="product-desc_info">
                                                        <h6>
                                                            <a class="product-name" asp-area="" asp-controller="Product"
                                                               asp-action="ProductDetail" asp-route-designId="@item.DesignId">@item.DesignName</a>
                                                        </h6>
                                                        <div class="rating-box">
                                                            <ul>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li><i class="fa fa-star-of-david"></i></li>
                                                                <li class="silver-color">
                                                                    <i class="fa fa-star-of-david"></i>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="price-box">
                                                            <span class="new-price">@item.Price VND</span>
                                                        </div>
                                                        <div class="product-short_desc">
                                                            <p>
                                                                @item.Description
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="add-actions">
                                                        <ul>
                                                            <li>                                                                
                                                                <a class="hiraola-add_cart"
                                                                   href="javascript:void(0)"
                                                                   onclick="addToCart('@item.DesignId', 1, false)"
                                                                   data-bs-toggle="tooltip"
                                                                   data-placement="top"
                                                                   title="Giỏ Hàng">
                                                                    Thêm
                                                                </a>
                                                            </li>
                                                            <li class="quick-view-btn"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#exampleModalCenter">
                                                                <a asp-controller="Product"
                                                                   asp-action="ProductDetail"
                                                                   asp-route-designId="@item.DesignId"
                                                                   data-bs-toggle="tooltip"
                                                                   data-placement="top"
                                                                   title="Xem">
                                                                    <i class="ion-eye"></i>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="hiraola-paginatoin-area">
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-6">
                                            <ul class="hiraola-pagination-box">
                                                @if (ViewBag.Page > 1)
                                                {
                                                    <li>
                                                        <a asp-action="ProductList"
                                                           asp-route-modelId="@ViewBag.ModelId"
                                                           asp-route-minPrice="@ViewBag.MinPrice"
                                                           asp-route-maxPrice="@ViewBag.MaxPrice"
                                                           asp-route-page="@(ViewBag.Page - 1)"
                                                           asp-route-pageSize="@ViewBag.PageSize">
                                                            <i class="ion-ios-arrow-left"></i>
                                                        </a>
                                                    </li>
                                                }
                                                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                                {
                                                    <li class="@(i == ViewBag.Page ? "active" : "")">
                                                        <a asp-action="ProductList"
                                                           asp-route-modelId="@ViewBag.ModelId"
                                                           asp-route-minPrice="@ViewBag.MinPrice"
                                                           asp-route-maxPrice="@ViewBag.MaxPrice"
                                                           asp-route-page="@i"
                                                           asp-route-pageSize="@ViewBag.PageSize">@i</a>
                                                    </li>
                                                }
                                                @if (ViewBag.Page < ViewBag.TotalPages)
                                                {
                                                    <li>
                                                        <a asp-action="ProductList"
                                                           asp-route-modelId="@ViewBag.ModelId"
                                                           asp-route-minPrice="@ViewBag.MinPrice"
                                                           asp-route-maxPrice="@ViewBag.MaxPrice"
                                                           asp-route-page="@(ViewBag.Page + 1)"
                                                           asp-route-pageSize="@ViewBag.PageSize">
                                                            <i class="ion-ios-arrow-right"></i>
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div class="col-lg-6 col-md-6 col-sm-6">
                                            <div class="product-select-box">
                                                <div class="product-short">
                                                    <p>(@(ViewBag.PageSize * (ViewBag.Page - 1) + 1) - @(Math.Min(ViewBag.PageSize * ViewBag.Page, ViewBag.TotalCount))) - (@ViewBag.TotalPages Trang)</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Thêm CSRF Token -->
    <form id="antiForgeryForm">
        @Html.AntiForgeryToken()
    </form>

    <!-- Thêm SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- CSS tùy chỉnh cho SweetAlert2 -->
    <style>
        /* Tùy chỉnh SweetAlert2 để đồng bộ với giao diện website */
        .swal2-popup {
            font-family: 'Lato', sans-serif; /* Font chữ giống website */
            background: #f4f4f4; /* Màu nền xám nhạt giống form */
            color: #595959; /* Màu chữ xám giống nội dung */
            border: 1px solid #e5e5e5; /* Viền giống các thành phần trên website */
            border-radius: 8px; /* Bo góc nhẹ */
        }

        .swal2-title {
            color: #333; /* Màu tiêu đề giống website */
            font-size: 18px; /* Kích thước chữ tiêu đề */
            font-weight: 700; /* Đậm giống h3, h4 */
        }

        .swal2-content {
            color: #595959; /* Màu nội dung giống website */
            font-size: 16px; /* Kích thước chữ nội dung */
        }

        .swal2-confirm {
            background-color: #cda557 !important; /* Nút "Xác nhận" màu vàng */
            color: #fff !important; /* Chữ trắng */
            border-radius: 3px !important; /* Bo góc giống hiraola-btn */
            padding: 10px 20px !important; /* Kích thước giống nút */
            font-size: 12px !important; /* Kích thước chữ */
            text-transform: uppercase !important; /* Chữ in hoa */
            transition: all 0.3s ease-in !important; /* Hiệu ứng chuyển đổi */
        }

        .swal2-cancel {
            background-color: #595959 !important; /* Nút "Hủy" màu xám đậm */
            color: #fff !important; /* Chữ trắng */
            border-radius: 3px !important; /* Bo góc giống hiraola-btn */
            padding: 10px 20px !important; /* Kích thước giống nút */
            font-size: 12px !important; /* Kích thước chữ */
            text-transform: uppercase !important; /* Chữ in hoa */
            transition: all 0.3s ease-in !important; /* Hiệu ứng chuyển đổi */
        }

        .swal2-confirm:hover {
            background-color: #d5b473 !important; /* Hover màu vàng nhạt hơn */
        }

        .swal2-cancel:hover {
            background-color: #333 !important; /* Hover màu xám đậm hơn */
        }

        .swal2-icon.swal2-warning {
            color: #cda557 !important; /* Màu biểu tượng cảnh báo */
            border-color: #cda557 !important;
        }

        .swal2-icon.swal2-error {
            color: #ea3a3c !important; /* Màu biểu tượng lỗi (đỏ) */
            border-color: #ea3a3c !important;
        }
    </style>
    <script>
         function addToCart(designId, quantity, productType) {
            $.ajax({
                url: '/Cart/AddToCart',
                type: 'POST',
                data: {
                    designId: designId,
                    quantity: quantity,
                    productType: productType
                },
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: 'Thành công',
                            text: 'Sản phẩm đã được thêm vào giỏ hàng!',
                            icon: 'success',
                            confirmButtonText: 'Đóng',
                            customClass: {
                                confirmButton: 'swal2-confirm'
                            }
                        });
                        // Cập nhật số lượng giỏ hàng
                        updateCartCount();
                    } else {
                        Swal.fire({
                            title: 'Lỗi',
                            text: response.message,
                            icon: 'error',
                            confirmButtonText: 'Đóng'
                        });
                    }
                },
                error: function (xhr) {
                    if (xhr.status === 401) {
                        Swal.fire({
                            title: 'Yêu cầu đăng nhập',
                            text: 'Vui lòng đăng nhập để thêm sản phẩm vào giỏ hàng.',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Đăng nhập',
                            cancelButtonText: 'Đóng',
                            customClass: {
                                confirmButton: 'swal2-confirm',
                                cancelButton: 'swal2-cancel'
                            }
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.href = '/Auth/Register';
                            }
                        });
                    } else {
                        Swal.fire({
                            title: 'Lỗi',
                            text: 'Có lỗi xảy ra, vui lòng thử lại.',
                            icon: 'error',
                            confirmButtonText: 'Đóng'
                        });
                    }
                }
            });
        }

        function updateCartCount() {
            $.ajax({
                url: '/Cart/GetCartItemCount',
                type: 'GET',
                success: function (response) {
                    if (response.success) {
                        $('#cart-count').text(response.count);
                    } else {
                        $('#cart-count').text('0');
                    }
                },
                error: function () {
                    $('#cart-count').text('0');
                }
            });
        }

        // Gọi updateCartCount khi trang tải
        $(document).ready(function () {
            updateCartCount();
        });

        // Hàm lọc sản phẩm theo model
        function filterByModel(modelId) {
            $.ajax({
                url: '/Product/ProductList',
                type: 'GET',
                data: {
                    modelId: modelId,
                    minPrice: $('#minPrice').val(),
                    maxPrice: $('#maxPrice').val(),
                    page: 1,
                    pageSize: @ViewBag.PageSize
                },
                success: function (response) {
                    // Cập nhật khu vực sản phẩm
                    $('.shop-product-wrap').html($(response).find('.shop-product-wrap').html());
                    // Cập nhật phân trang
                    $('.hiraola-paginatoin-area').html($(response).find('.hiraola-paginatoin-area').html());
                    // Cập nhật trạng thái active cho liên kết model
                    $('.model-filter').removeClass('active');
                    $(`.model-filter[data-model-id="${modelId}"]`).addClass('active');
                    // Cập nhật URL trình duyệt mà không tải lại trang
                    const url = new URL(window.location);
                    if (modelId) {
                        url.searchParams.set('modelId', modelId);
                    } else {
                        url.searchParams.delete('modelId');
                    }
                    window.history.pushState({}, '', url);
                },
                error: function () {
                    Swal.fire({
                        title: 'Lỗi',
                        text: 'Không thể tải danh sách sản phẩm. Vui lòng thử lại.',
                        icon: 'error',
                        confirmButtonText: 'Đóng'
                    });
                }
            });
        }

        // Gắn sự kiện click cho các liên kết model
        $(document).ready(function () {
            updateCartCount();
            $('.model-filter').on('click', function () {
                const modelId = $(this).data('model-id');
                filterByModel(modelId);
            });
        });
    </script>
</body>