@model BusinessLogicLayer.Dtos.CartDtos.CartAndListCartItemViewModel

<body class="template-color-1">

    <div class="main-wrapper">
        <!-- Begin Hiraola's Breadcrumb Area -->
        <div class="breadcrumb-area">
            <div class="container">
                <div class="breadcrumb-content">
                    <h2>Giỏ Hàng</h2>
                    <ul>
                        <li><a href="/Product/ProductList">Danh sách</a></li>
                        <li class="active">Giỏ Hàng</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Hiraola's Breadcrumb Area End Here -->
        <!-- Begin Hiraola's Cart Area -->
        <div class="hiraola-cart-area">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <form action="javascript:void(0)">
                            <div class="table-content table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="hiraola-product-remove">Xóa</th>
                                            <th class="hiraola-product-thumbnail">Ảnh</th>
                                            <th class="cart-product-name">Sản Phẩm</th>
                                            <th class="hiraola-product-price">Giá</th>
                                            <th class="hiraola-product-quantity">Số Lượng</th>
                                            <th class="hiraola-product-subtotal">Tổng</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @* <tr>
                                            <td class="hiraola-product-remove">
                                                <a href="javascript:void(0)">
                                                    <i class="fa fa-trash"
                                                       title="Remove"></i>
                                                </a>
                                            </td>
                                            <td class="hiraola-product-thumbnail"><a href="javascript:void(0)"><img src="assets/images/product/small-size/2-1.jpg" alt="Hiraola's Cart Thumbnail"></a></td>
                                            <td class="hiraola-product-name"><a href="javascript:void(0)">Juma rema pola</a></td>
                                            <td class="hiraola-product-price"><span class="amount">$46.80</span></td>
                                            <td class="quantity">
                                                <label>Quantity</label>
                                                <div class="cart-plus-minus">
                                                    <input class="cart-plus-minus-box" value="1" type="text">
                                                    <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                    <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                                </div>
                                            </td>
                                            <td class="product-subtotal"><span class="amount">$46.80</span></td>
                                        </tr>
                                        <tr>
                                            <td class="hiraola-product-remove">
                                                <a href="javascript:void(0)">
                                                    <i class="fa fa-trash"
                                                       title="Remove"></i>
                                                </a>
                                            </td>
                                            <td class="hiraola-product-thumbnail"><a href="javascript:void(0)"><img src="assets/images/product/small-size/2-2.jpg" alt="Hiraola's Cart Thumbnail"></a></td>
                                            <td class="hiraola-product-name"><a href="javascript:void(0)">Bag Goodscol model</a></td>
                                            <td class="hiraola-product-price"><span class="amount">$71.80</span></td>
                                            <td class="quantity">
                                                <label>Quantity</label>
                                                <div class="cart-plus-minus">
                                                    <input class="cart-plus-minus-box" value="1" type="text">
                                                    <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                    <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                                </div>
                                            </td>
                                            <td class="product-subtotal"><span class="amount">$71.80</span></td>
                                        </tr> *@
                                        @if (Model.cartItemsViewModel != null && Model.cartItemsViewModel.Any())
                                        {
                                            foreach (var item in Model.cartItemsViewModel)
                                            {
                                                <tr>
                                                    <td class="hiraola-product-remove">
                                                        <a href="javascript:void(0)" onclick="removeFromCart('@item.DesignId')">
                                                            <i class="fa fa-trash" title="Remove"></i>
                                                        </a>
                                                    </td>
                                                    <td class="hiraola-product-thumbnail">
                                                        <a href="javascript:void(0)">
                                                            <img src="@item.Design.FirstImage.ImageUrl" alt="Hiraola's Cart Thumbnail" style="max-width:30%">
                                                        </a>
                                                    </td>
                                                    <td class="hiraola-product-name">
                                                        <a href="javascript:void(0)">@item.Design.DesignName</a>
                                                    </td>
                                                    <td class="hiraola-product-price">
                                                        <span class="amount">@item.Price VND</span>
                                                    </td>
                                                    <td class="quantity">
                                                        <label>Số Lượng</label>
                                                        <div class="cart-plus-minus">
                                                            <input class="cart-plus-minus-box" value="@item.Quantity" type="text" onchange="updateQuantity('@item.DesignId', this.value)">
                                                            <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                            <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                                        </div>
                                                    </td>
                                                    <td class="product-subtotal">
                                                        <span class="amount">@((item.Quantity * item.Price)) VND</span>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <td colspan="6">Giỏ hàng trống</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-md-5 ml-auto">
                                    <div class="cart-page-total">
                                        <h2>Tổng Giỏ Hàng</h2>
                                        @* <ul>
                                            <li>Tổng <span>120000 VNĐ</span></li>
                                        </ul>
                                        <a href="javascript:void(0)">Thanh Toán</a> *@
                                        <ul>
                                            <li>Tổng <span>@(Model.CartViewModel?.Total ?? 0) VND</span></li>
                                        </ul>
                                        <a href="javascript:void(0)">Thanh Toán</a>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Hiraola's Cart Area End Here -->       
    </div>
    <script>
        function updateQuantity(designId, quantity) {
            quantity = parseInt(quantity);
            if (isNaN(quantity) || quantity <= 0) {
                alert("Số lượng phải lớn hơn 0");
                return;
            }

            $.ajax({
                url: '/Cart/UpdateCart',
                type: 'POST',
                data: {
                    designId: designId,
                    quantity: quantity
                },
                success: function (response) {
                    window.location.reload(); // Tải lại trang để cập nhật giỏ hàng
                },
                error: function () {
                    alert("Có lỗi xảy ra khi cập nhật số lượng.");
                }
            });
        }

        function removeFromCart(designId) {
            if (confirm("Bạn có chắc muốn xóa sản phẩm này khỏi giỏ hàng?")) {
                $.ajax({
                    url: '/Cart/UpdateCart',
                    type: 'POST',
                    data: {
                        designId: designId,
                        quantity: 0 // Gửi quantity = 0 để xóa
                    },
                    success: function (response) {
                        window.location.reload();
                    },
                    error: function () {
                        alert("Có lỗi xảy ra khi xóa sản phẩm.");
                    }
                });
            }
        }
    </script>
</body>